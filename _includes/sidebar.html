<div class="sidebar">
  <div class="container sidebar-scrollable">
    <div class="sidebar-about">
      <a href="{{ '/' | relative_url }}">
        <img class="sidebar-logo" src="{{ '/public/img/logo.png' | relative_url }}" alt="{{ site.title }}">
      </a>
      <p class="lead">{{ site.description }}</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item{% if page.url == '/' or page.url == site.baseurl %} active{% endif %}" href="{{ '/' | relative_url }}">Home</a>
      <a class="sidebar-nav-item{% if page.path == 'wiki/README.md' %} active{% endif %}" href="{{ '/wiki/README/' | relative_url }}">Wiki Overview</a>

      {% comment %}
        Group wiki pages by category for collapsible sidebar navigation.
        Pages must have `category` and `sidebar_order` in front matter.
        7 groups ordered from low-level physics to high-level reference.
      {% endcomment %}

      {% assign wiki_pages = site.pages | where_exp: "p", "p.path contains 'wiki/'" %}

      {% comment %} === Physics Primitives === {% endcomment %}
      {% assign physics_pages = wiki_pages | where: "category", "physics" | sort: "sidebar_order" %}
      {% if physics_pages.size > 0 %}
        {% assign physics_active = false %}
        {% for p in physics_pages %}
          {% if page.url == p.url %}{% assign physics_active = true %}{% endif %}
        {% endfor %}
        <details class="sidebar-group"{% if physics_active %} open{% endif %}>
          <summary class="sidebar-group-heading">Physics Primitives</summary>
          {% for p in physics_pages %}
            <a class="sidebar-nav-item sidebar-nav-subitem{% if page.url == p.url %} active{% endif %}" href="{{ p.url | relative_url }}">{{ p.title }}</a>
          {% endfor %}
        </details>
      {% endif %}

      {% comment %} === Music Primitives === {% endcomment %}
      {% assign music_pages = wiki_pages | where: "category", "music" | sort: "sidebar_order" %}
      {% if music_pages.size > 0 %}
        {% assign music_active = false %}
        {% for p in music_pages %}
          {% if page.url == p.url %}{% assign music_active = true %}{% endif %}
        {% endfor %}
        <details class="sidebar-group"{% if music_active %} open{% endif %}>
          <summary class="sidebar-group-heading">Music Primitives</summary>
          {% for p in music_pages %}
            <a class="sidebar-nav-item sidebar-nav-subitem{% if page.url == p.url %} active{% endif %}" href="{{ p.url | relative_url }}">{{ p.title }}</a>
          {% endfor %}
        </details>
      {% endif %}

      {% comment %} === How Ears Hear === {% endcomment %}
      {% assign hearing_pages = wiki_pages | where: "category", "hearing" | sort: "sidebar_order" %}
      {% if hearing_pages.size > 0 %}
        {% assign hearing_active = false %}
        {% for p in hearing_pages %}
          {% if page.url == p.url %}{% assign hearing_active = true %}{% endif %}
        {% endfor %}
        <details class="sidebar-group"{% if hearing_active %} open{% endif %}>
          <summary class="sidebar-group-heading">How Ears Hear</summary>
          {% for p in hearing_pages %}
            <a class="sidebar-nav-item sidebar-nav-subitem{% if page.url == p.url %} active{% endif %}" href="{{ p.url | relative_url }}">{{ p.title }}</a>
          {% endfor %}
        </details>
      {% endif %}

      {% comment %} === Physics in Depth === {% endcomment %}
      {% assign deep_pages = wiki_pages | where: "category", "deep-physics" | sort: "sidebar_order" %}
      {% if deep_pages.size > 0 %}
        {% assign deep_active = false %}
        {% for p in deep_pages %}
          {% if page.url == p.url %}{% assign deep_active = true %}{% endif %}
        {% endfor %}
        <details class="sidebar-group"{% if deep_active %} open{% endif %}>
          <summary class="sidebar-group-heading">Physics in Depth</summary>
          {% for p in deep_pages %}
            <a class="sidebar-nav-item sidebar-nav-subitem{% if page.url == p.url %} active{% endif %}" href="{{ p.url | relative_url }}">{{ p.title }}</a>
          {% endfor %}
        </details>
      {% endif %}

      {% comment %} === Sound Design === {% endcomment %}
      {% assign design_pages = wiki_pages | where: "category", "sound-design" | sort: "sidebar_order" %}
      {% if design_pages.size > 0 %}
        {% assign design_active = false %}
        {% for p in design_pages %}
          {% if page.url == p.url %}{% assign design_active = true %}{% endif %}
        {% endfor %}
        <details class="sidebar-group"{% if design_active %} open{% endif %}>
          <summary class="sidebar-group-heading">Sound Design</summary>
          {% for p in design_pages %}
            <a class="sidebar-nav-item sidebar-nav-subitem{% if page.url == p.url %} active{% endif %}" href="{{ p.url | relative_url }}">{{ p.title }}</a>
          {% endfor %}
        </details>
      {% endif %}

      {% comment %} === Organizing Pitch === {% endcomment %}
      {% assign systems_pages = wiki_pages | where: "category", "systems" | sort: "sidebar_order" %}
      {% if systems_pages.size > 0 %}
        {% assign systems_active = false %}
        {% for p in systems_pages %}
          {% if page.url == p.url %}{% assign systems_active = true %}{% endif %}
        {% endfor %}
        <details class="sidebar-group"{% if systems_active %} open{% endif %}>
          <summary class="sidebar-group-heading">Organizing Pitch</summary>
          {% for p in systems_pages %}
            <a class="sidebar-nav-item sidebar-nav-subitem{% if page.url == p.url %} active{% endif %}" href="{{ p.url | relative_url }}">{{ p.title }}</a>
          {% endfor %}
        </details>
      {% endif %}

      {% comment %} === Reference === {% endcomment %}
      {% assign ref_pages = wiki_pages | where: "category", "reference" | sort: "sidebar_order" %}
      {% if ref_pages.size > 0 %}
        {% assign ref_active = false %}
        {% for p in ref_pages %}
          {% if page.url == p.url %}{% assign ref_active = true %}{% endif %}
        {% endfor %}
        <details class="sidebar-group"{% if ref_active %} open{% endif %}>
          <summary class="sidebar-group-heading">Reference</summary>
          {% for p in ref_pages %}
            <a class="sidebar-nav-item sidebar-nav-subitem{% if page.url == p.url %} active{% endif %}" href="{{ p.url | relative_url }}">{{ p.title }}</a>
          {% endfor %}
        </details>
      {% endif %}

    </nav>

    <p class="sidebar-footer">&copy; {{ site.time | date: '%Y' }}. All rights reserved.</p>
  </div>
</div>
